version: '3.7'
services:
  spark-master:
    image: michalklempa/spark:3.0.1-hadoop2.7
    command: /opt/spark/master.sh
    networks:
      - spark
    ports:
      - target: 8080
        published: 8080
        protocol: tcp
        mode: host
      - target: 7077
        published: 7077
        protocol: tcp
        mode: host

  spark-worker-1:
    image: michalklempa/spark:3.0.1-hadoop2.7
    command: /opt/spark/worker.sh
    networks:
      - spark
    ports:
      - target: 8080
        published: 8081
        protocol: tcp
        mode: host

  spark-worker-2:
    image: michalklempa/spark:3.0.1-hadoop2.7
    command: /opt/spark/worker.sh
    networks:
      - spark
    ports:
      - target: 8080
        published: 8082
        protocol: tcp
        mode: host

  spark-worker-3:
    image: michalklempa/spark:3.0.1-hadoop2.7
    command: /opt/spark/worker.sh
    networks:
      - spark
    ports:
      - target: 8080
        published: 8083
        protocol: tcp
        mode: host

#  spark-driver:
#    depends_on:
#      - spark-master
#    image: michalklempa/spark:3.0.1-hadoop2.7
#    command: /opt/spark/submit.sh
#    restart: on-failure
#    networks:
#      - spark

networks:
  spark:
    external: true
